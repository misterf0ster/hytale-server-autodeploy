<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Hytale Control Panel</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; }
        
        /* Верхняя панель с кнопками как на макете */
        .header-tools { display: flex; gap: 10px; margin-bottom: 20px; background: #222; padding: 10px; border-radius: 8px; border: 1px solid #444; }
        .btn { padding: 10px 15px; border: 2px solid #000; cursor: pointer; font-weight: bold; text-transform: uppercase; border-radius: 4px; transition: 0.2s; }
        .btn-start { background: #28a745; color: white; }
        .btn-stop { background: #dc3545; color: white; }
        .btn-install { background: #007bff; color: white; }
        .btn:hover { opacity: 0.8; transform: translateY(-1px); }

        /* Окно консоли */
        #terminal { 
            background: #000; height: 500px; overflow-y: auto; 
            padding: 20px; border: 3px solid #333; border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace; line-height: 1.4;
            box-shadow: inset 0 0 10px #000;
        }

        /* Поле ввода снизу */
        .input-bar { display: flex; margin-top: 15px; gap: 5px; }
        #console-input { 
            flex-grow: 1; background: #2a2a2a; border: 2px solid #444; 
            color: #0f0; padding: 12px; font-family: monospace; border-radius: 4px;
        }
        #send-btn { background: #444; color: white; border: 2px solid #000; padding: 0 20px; cursor: pointer; font-weight: bold; }

        /* Стиль кнопки авторизации из твоего кода */
        .auth-button-container { margin: 15px 0; text-align: center; }
        .auth-link { 
            background: #ffc107; color: black; padding: 12px 25px; 
            text-decoration: none; font-weight: bold; border-radius: 5px; 
            display: inline-block; border: 2px solid #000; 
        }
    </style>
</head>
<body>

    <div class="header-tools">
        <button class="btn btn-start" onclick="action('start')">Запустить</button>
        <button class="btn btn-stop" onclick="action('stop')">Остановить</button>
        <button class="btn btn-install" onclick="action('download_world')">Скачать мир</button>
        <button class="btn btn-install" onclick="action('install')">Установить сервер</button>
    </div>

    <div id="terminal">Ожидание запуска процесса...</div>

    <div class="input-bar">
        <input type="text" id="console-input" placeholder="Поле ввода для консоли (напр. /help)..." onkeydown="if(event.key==='Enter') sendCommand()">
        <button id="send-btn" onclick="sendCommand()">ОТПРАВИТЬ</button>
    </div>

    <script>
        let eventSource;

        function action(type) {
            const terminal = document.getElementById('terminal');
            terminal.innerHTML += `<div style="color: #aaa;">> Инициализация ${type}...</div>`;
            
            if (eventSource) eventSource.close();
            
            // Запуск соответствующего потока из app.py
            eventSource = new EventSource(`/stream_${type}`);
            
            eventSource.onmessage = function(e) {
                // Твоя логика обработки ссылки
                if (e.data.startsWith("BUTTON_LINK|")) {
                    const url = e.data.split("|")[1];
                    const btnDiv = document.createElement('div');
                    btnDiv.className = 'auth-button-container';
                    btnDiv.innerHTML = `<a href="${url}" target="_blank" class="auth-link">АВТОРИЗОВАТЬСЯ В HYTALE</a>`;
                    terminal.appendChild(btnDiv);
                } else {
                    const div = document.createElement('div');
                    div.textContent = e.data;
                    // Цвета для логов
                    if (e.data.includes("[OK]")) div.style.color = "#28a745";
                    if (e.data.includes("[ERROR]")) div.style.color = "#dc3545";
                    if (e.data.includes("[WARN]")) div.style.color = "#ffc107";
                    terminal.appendChild(div);
                }
                terminal.scrollTop = terminal.scrollHeight;
            };
        }

        function sendCommand() {
            const input = document.getElementById('console-input');
            const cmd = input.value;
            if (!cmd) return;

            fetch('/send_command', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({command: cmd})
            });
            
            const terminal = document.getElementById('terminal');
            terminal.innerHTML += `<div style="color: #0cf;">[GUI] > ${cmd}</div>`;
            input.value = '';
            terminal.scrollTop = terminal.scrollHeight;
        }
    </script>
</body>
</html>